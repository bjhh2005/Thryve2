# 工作流JSON生成功能集成说明

## 功能概述

我们已经成功将完整的工作流JSON生成指南集成到AI聊天系统中。现在AI助手可以：

1. **自动检测**用户的工作流需求
2. **动态加载**相关的专业指南
3. **智能生成**符合Thryve规范的工作流JSON
4. **提供快捷**的工作流模板入口

## 主要特性

### 1. 智能需求检测
AI会自动识别以下类型的工作流需求：
- PDF处理（提取、分割、合并、加密等）
- 图像处理（调整尺寸、压缩、转换、滤镜等）
- 文本处理（追加、替换、词频统计等）
- CSV数据处理（筛选、排序、聚合等）
- JSON数据处理（查询、更新、验证等）
- Markdown文档处理
- LLM智能分析
- 循环和条件控制逻辑

### 2. 动态指南加载
根据用户具体需求，AI会自动加载对应的：
- 节点模板和参数配置
- 特定处理器的所有模式说明
- 控制流程的实现方法
- 完整的JSON结构规范

### 3. 完整模式支持
**PDF处理器**（8种模式）：
- extract, split, merge, encrypt, decrypt, convert, watermark, metadata

**图像处理器**（7种模式）：
- resize, compress, convert, rotate, crop, filter, watermark

**文本处理器**（4种模式）：
- append, write, replace, wordFreq

**CSV处理器**（3种模式）：
- filter, sort, aggregate

**JSON处理器**（4种模式）：
- query, update, validate, diff

**Markdown处理器**（6种模式）：
- write, append, convert, frontMatter, toc, lint

### 4. 快捷模板入口
在新会话中提供常用模板快捷按钮：
- PDF文本提取
- 批量图片处理  
- CSV数据处理
- LLM文档分析

## 使用方法

### 方式一：直接描述需求
```
用户输入示例：
"我想处理PDF文件，提取其中的文本内容"
"帮我批量调整图片尺寸为800x600"
"创建一个CSV数据筛选的工作流"
"用LLM分析多个文档内容"
```

### 方式二：使用快捷按钮
1. 打开AI助手面板
2. 在新会话中点击相应的快捷按钮
3. AI会自动填充对应的需求描述

### 方式三：详细需求描述
```
用户输入示例：
"我需要一个工作流来：
1. 读取一个PDF文件
2. 提取第1-5页的文本和图片
3. 将结果保存到指定文件夹"
```

## AI响应示例

当用户提出工作流需求时，AI会：

1. **需求确认**：明确用户的具体需求
2. **方案说明**：解释工作流的设计思路
3. **JSON生成**：提供完整可用的工作流JSON
4. **使用指导**：说明如何在Thryve中使用

## 技术实现

### 后端检测机制
- **关键词检测**：识别工作流相关术语
- **模式匹配**：使用正则表达式检测需求模式
- **需求解析**：提取文件类型、操作类型、工作流类型
- **指南匹配**：根据需求动态组装相关指南

### 前端交互优化
- **快捷入口**：新会话显示常用模板按钮
- **智能输入**：点击按钮自动填充输入框
- **流式响应**：实时显示AI生成过程

## 配置文件说明

### 后端文件
- `Backend/config/workflow_guide.py` - 基础指南模板
- `Backend/config/workflow_detector.py` - 需求检测逻辑
- `Backend/app.py` - 聊天API集成

### 前端文件
- `Fronted1/src/components/sidebar-left/AIAssistant/ChatView.tsx` - 快捷界面
- `Fronted1/src/components/sidebar-left/AIAssistant/ChatView.less` - 样式文件

## 使用注意事项

1. **明确需求**：尽量详细描述文件类型和处理需求
2. **检查JSON**：AI生成的JSON可以直接使用，但建议检查关键参数
3. **文件路径**：实际使用时需要修改文件路径为您的实际路径
4. **权限配置**：确保AI模型已正确配置（API密钥等）

## 扩展说明

如需添加新的处理器类型或模式：

1. **更新指南**：在`workflow_guide.py`中添加新的模板
2. **更新检测**：在`workflow_detector.py`中添加相应的检测逻辑
3. **测试验证**：确保新增功能与现有系统兼容

## 故障排查

### 常见问题

**问题1：AI没有识别到工作流需求**
- 检查关键词是否包含在`WORKFLOW_KEYWORDS`中
- 尝试使用更明确的描述，如"创建工作流"、"处理文件"

**问题2：生成的JSON格式不正确**
- 检查系统提示词是否正确加载
- 确认AI模型配置正常

**问题3：快捷按钮不显示**
- 确认是在新会话中（消息列表为空）
- 检查前端代码是否正确部署

通过这个集成方案，用户现在可以通过自然语言与AI对话，快速生成符合Thryve规范的工作流JSON配置，大大提升了工作流创建的效率和便利性。 